
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta
            name="description"
            content="Documentation for Satori Perpetual Protocol"
        >
    <title>API Reference</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-f0df1403.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-a151e035.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-b12a2749.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;python&quot;,&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-36af77e2.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#perpetual-contract-concepts" class="toc-h1 toc-link" data-title="Perpetual Contract Concepts">Perpetual Contract Concepts</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#margin" class="toc-h2 toc-link" data-title="Margin">Margin</a>
                  </li>
                  <li>
                    <a href="#liquidations" class="toc-h2 toc-link" data-title="Liquidations">Liquidations</a>
                  </li>
                  <li>
                    <a href="#contract-losses" class="toc-h2 toc-link" data-title="Contract Losses">Contract Losses</a>
                  </li>
                  <li>
                    <a href="#funding-costs" class="toc-h2 toc-link" data-title="Funding Costs">Funding Costs</a>
                  </li>
                  <li>
                    <a href="#index-price" class="toc-h2 toc-link" data-title="Index Price">Index Price</a>
                  </li>
                  <li>
                    <a href="#oracle-price" class="toc-h2 toc-link" data-title="Oracle Price">Oracle Price</a>
                  </li>
                  <li>
                    <a href="#matchmaking" class="toc-h2 toc-link" data-title="Matchmaking">Matchmaking</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Welcome to the docs for the Satori Perpetual Protocol. Satori is a decentralized financial derivatives platform built on Polkadot. It features a hybrid of orderbook and AMM models to provide comprehensive exposure to a wide range of assets, and an “off-chain aggregation and on-chain settlement” design that combines the security and transparency of a decentralized exchange, with the speed and usability of a centralized exchange.</p>
<h1 id='perpetual-contract-concepts'>Perpetual Contract Concepts</h1><h2 id='margin'>Margin</h2>
<p>Satori enforces margin requirements for users -- an initial margin reqirement to open and size-up positions, and a maintenance margin requirement to avoid liquidations. The margin requirements are calculated as follows:</p>

<aside class="formula">
  <code>
    Initial Margin Requirement = abs(S × OP × I)
    Maintenance Margin Requirement = abs(S × OP × M)
  </code>
</aside>

<p>Where:</p>

<ul>
<li><code>S</code> is the size of the position</li>
<li><code>OP</code> is the oracle price for the market</li>
<li><code>I</code> is the initial margin rate for the market</li>
<li><code>M</code> is the maintenance margin rate for the market</li>
</ul>

<p>The margin rates are determined on a per-token-pair basis:</p>

<table><thead>
<tr>
<th>Token Pair</th>
<th>Initial Margin Rate</th>
<th>Maintenance Margin Rate</th>
</tr>
</thead><tbody>
<tr>
<td>BTC/USD</td>
<td>4%</td>
<td>3%</td>
</tr>
<tr>
<td>ETH/USD</td>
<td>4%</td>
<td>3%</td>
</tr>
<tr>
<td>LTC/USD</td>
<td>10%</td>
<td>5%</td>
</tr>
<tr>
<td>XRP/USD</td>
<td>10%</td>
<td>5%</td>
</tr>
</tbody></table>

<p>All collateral is held as USDC, and the quote asset for all perpetual markets is USDC. Satori uses cross-margining by default, meaning the margin is shared among all of the user&#39;s positions.</p>
<h3 id='transfer-out-restrictions'>Transfer out restrictions</h3>
<p>Users are not allowed to transfer out their account balance when the margin rate of their position is less than the alert margin rate.</p>

<aside class="formula">
  Transferable amount = available balance / 105%.
</aside>
<h2 id='liquidations'>Liquidations</h2>
<p>Accounts where the margin rate is less than or equal to the maintenance margin rate may be liquidated.</p>

<p>The platform will continuously calculate the risk factor of position burst:</p>

<aside class="formula">
  <code>
    risk of blow-out factor =
      maintenance margin / (available balance + position margin) * 100%.
  </code>
</aside>

<p>When a position burst is about to be triggered, the platform will cancel all current open orders to release margin and maintain the position.</p>

<p>If the maintenance margin requirement is still not met after the cancellation of an outstanding order, this remaining position is taken over by the strong closing engine at the bankruptcy price (i.e., the price at which the equity in the user&#39;s account equals zero).</p>

<p>The user&#39;s forced liquidation record can be seen directly in the history of commissions and transactions. The price shown will be the bankruptcy price, not the forced liquidation price.</p>

<p>After the system takes over the position, if the market price is better than the bankruptcy price, the order will be delegated to the market to be filled in a matchmaking manner as soon as possible.</p>

<p>Upon forced liquidation, all the user&#39;s positions in all contracts will be forced to close. The loss of a user subject to forced liquidation is close to or equal to all the assets in his virtual contract account.</p>
<h2 id='contract-losses'>Contract Losses</h2><h3 id='insurance-vault'>Insurance Vault</h3>
<p>When a user is liquidated, their remaining positions will be taken over by the forced liquidation system. If the liquidation cannot be filled by the time we reach the bankruptcy price, the loss will be covered by the insurance vault, a reserve maintained by the platform.</p>

<p>The main sources of the insurance vault are a percentage of the commission generated by the transaction, and the surplus of the burst position.</p>
<h3 id='automatic-deleverage-system'>Automatic Deleverage System</h3>
<p>In the event that the insurance vault is insufficient to cover a liquidation loss, the Automatic Deleveraging System (ADL) will automatically deleverage traders holding positions in the opposite direction.</p>

<p>The ADL will deleverage traders in descending order of profit and leverage, i.e. the higher the profit and the more leverage used the higher the ranking.</p>

<p>Traders can view their priority ranking for automatic position reduction via the “ADL Ranking” indicator in the UI.</p>

<p>Positions will be reduced atomically: after the first user&#39;s position in line has been fully reduced, the second position will continue to be reduced and so on.</p>
<h3 id='adl-ranking-calculation-method'>ADL ranking calculation method</h3>
<aside class="formula">
    <code>
    Ranking =
            % profit * effective leverage (if profit, i.e. % profit > 0)

            OR

            % profit / effective leverage (if loss, i.e. % profit < 0)
    </code>

</aside>

<p>Where:</p>

<ul>
<li><code>Effective leverage</code> is <code>mark value / (mark value - bankruptcy value)</code></li>
<li><code>% profit</code> is <code>(mark value - average open value) / average open value</code></li>
<li><code>Mark value</code> is the value of the position at mark price</li>
<li><code>Mark price</code> is the current price for the perpetual contracts of the asset you are viewing</li>
<li><code>Bankruptcy value</code> is the value of position at the bankruptcy price</li>
<li><code>Average open value</code> is the the value of position at average open price</li>
</ul>
<h2 id='funding-costs'>Funding Costs</h2>
<p>We anchor the price of perpetual contracts to the spot index price through a funding fee mechanism.</p>

<p>Long positions pay short positions when the market is bullish; short positions pay long positions when the market is bearish.</p>

<p>The funding fee is charged every hour.</p>

<p>The funding fee is calculated as follows:</p>

<aside class="formula">
  Funding fee = notional value of position held * funding fee rate
</aside>
<h3 id='funding-fee-rate-calculation'>Funding Fee Rate Calculation</h3>
<p>The funding fee rate is comprised of two components: the interest rate and the premium.</p>

<p>The interest rate is currently set to <code>0.03%</code> per day.</p>

<p>The premium is calculated using trailing 1 hour TWAPs, sampled once every second.</p>

<aside class="formula">
  Premium = (TWAP(contract_price) - TWAP(index_price)) / TWAP(index_price)
</aside>

<p>Altogether, the funding fee rate is calculated as:</p>

<aside class="formula">
    Funding fee rate = (Premium + Interest Rate) / 24
</aside>
<h2 id='index-price'>Index Price</h2>
<p>The <code>Index Price</code> refers to the price of the underlying asset on the spot market. It&#39;s an aggregate price based off price data from multiple exchanges and is used to trigger stop orders.</p>

<p>The exchanges we aggregate from are as follows for each currency pair:</p>
<h4 id='btc-usd'>BTC/USD</h4>
<p><code>Okex</code>
<code>Binance</code>
<code>Coinbase</code>
<code>Bitstamp</code></p>
<h4 id='eth-usd'>ETH/USD</h4>
<p><code>Okex</code>
<code>Binance</code>
<code>Coinbase</code>
<code>Bitstamp</code></p>
<h4 id='ltc-usd'>LTC/USD</h4>
<p><code>Okex</code>
<code>Coinbase</code>
<code>Bitstamp</code></p>
<h4 id='xrp-usd'>XRP/USD</h4>
<p><code>Okex</code>
<code>Coinbase</code>
<code>Bitstamp</code></p>

<p>We have implemented logic to ensure that index fluctuations are within the normal range when there is a significant deviation from the price of a single exchange.</p>

<p>If an exchange price deviates by more than 3% relative to the median price of all exchanges, the weight that exchange is given will be reduced.</p>
<h2 id='oracle-price'>Oracle Price</h2>
<p>The <code>Oracle Price</code> is an aggregate price calculated using multiple on-chain price oracles. Oracle prices are used to determine collateralization and liquidations on Satori.</p>

<p>Since the oracle price is also an aggregate price, it offers similar protection from flash crashes as the index price does.</p>

<p>For the Alpha launch, Satori runs its own oracle nodes on Layer 2.</p>
<h2 id='matchmaking'>Matchmaking</h2>
<p>Orders will be aggregated by price-time on a FIFO basis. A transaction happens if there is a buy order that has a price equal or greater than a sell order, or if there is a market order placed in one direction and orders exist in the opposing direction</p>

<!-- ```ruby
require 'kittn'

api = Kittn::APIClient.authorize!('meowmeowmeow')
```

```python
import kittn

api = kittn.authorize('meowmeowmeow')
```

```shell
# With shell, you can just pass the correct header with each request
curl "api_endpoint_here" \
  -H "Authorization: meowmeowmeow"
```

```javascript
const kittn = require("kittn");

let api = kittn.authorize("meowmeowmeow");
```

> Make sure to replace `meowmeowmeow` with your API key.

Kittn uses API keys to allow access to the API. You can register a new Kittn API key at our [developer portal](http://example.com/developers).

Kittn expects for the API key to be included in all API requests to the server in a header that looks like the following:

`Authorization: meowmeowmeow`

<aside class="notice">
You must replace <code>meowmeowmeow</code> with your personal API key.
</aside>

# Kittens

## Get All Kittens

```ruby
require 'kittn'

api = Kittn::APIClient.authorize!('meowmeowmeow')
api.kittens.get
```

```python
import kittn

api = kittn.authorize('meowmeowmeow')
api.kittens.get()
```

```shell
curl "http://example.com/api/kittens" \
  -H "Authorization: meowmeowmeow"
```

```javascript
const kittn = require("kittn");

let api = kittn.authorize("meowmeowmeow");
let kittens = api.kittens.get();
```

> The above command returns JSON structured like this:

```json
[
  {
    "id": 1,
    "name": "Fluffums",
    "breed": "calico",
    "fluffiness": 6,
    "cuteness": 7
  },
  {
    "id": 2,
    "name": "Max",
    "breed": "unknown",
    "fluffiness": 5,
    "cuteness": 10
  }
]
```

This endpoint retrieves all kittens.

### HTTP Request

`GET http://example.com/api/kittens`

### Query Parameters

| Parameter    | Default | Description                                                                      |
| ------------ | ------- | -------------------------------------------------------------------------------- |
| include_cats | false   | If set to true, the result will also include cats.                               |
| available    | true    | If set to false, the result will include kittens that have already been adopted. |

<aside class="success">
Remember — a happy kitten is an authenticated kitten!
</aside>

## Get a Specific Kitten

```ruby
require 'kittn'

api = Kittn::APIClient.authorize!('meowmeowmeow')
api.kittens.get(2)
```

```python
import kittn

api = kittn.authorize('meowmeowmeow')
api.kittens.get(2)
```

```shell
curl "http://example.com/api/kittens/2" \
  -H "Authorization: meowmeowmeow"
```

```javascript
const kittn = require("kittn");

let api = kittn.authorize("meowmeowmeow");
let max = api.kittens.get(2);
```

> The above command returns JSON structured like this:

```json
{
  "id": 2,
  "name": "Max",
  "breed": "unknown",
  "fluffiness": 5,
  "cuteness": 10
}
```

This endpoint retrieves a specific kitten.

<aside class="warning">Inside HTML code blocks like this one, you can't use Markdown, so use <code>&lt;code&gt;</code> blocks to denote code.</aside>

### HTTP Request

`GET http://example.com/kittens/<ID>`

### URL Parameters

| Parameter | Description                      |
| --------- | -------------------------------- |
| ID        | The ID of the kitten to retrieve |

## Delete a Specific Kitten

```ruby
require 'kittn'

api = Kittn::APIClient.authorize!('meowmeowmeow')
api.kittens.delete(2)
```

```python
import kittn

api = kittn.authorize('meowmeowmeow')
api.kittens.delete(2)
```

```shell
curl "http://example.com/api/kittens/2" \
  -X DELETE \
  -H "Authorization: meowmeowmeow"
```

```javascript
const kittn = require("kittn");

let api = kittn.authorize("meowmeowmeow");
let max = api.kittens.delete(2);
```

> The above command returns JSON structured like this:

```json
{
  "id": 2,
  "deleted": ":("
}
```

This endpoint deletes a specific kitten.

### HTTP Request

`DELETE http://example.com/kittens/<ID>`

### URL Parameters

| Parameter | Description                    |
| --------- | ------------------------------ |
| ID        | The ID of the kitten to delete | -->
<h1 id='errors'>Errors</h1>
<aside class="notice">
This error section is stored in a separate file in <code>includes/_errors.md</code>. Slate allows you to optionally separate out your docs into many files...just save them to the <code>includes</code> folder and add them to the top of your <code>index.md</code>'s frontmatter. Files are included in the order listed.
</aside>

<p>The Kittn API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request -- Your request is invalid.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized -- Your API key is wrong.</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden -- The kitten requested is hidden for administrators only.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found -- The specified kitten could not be found.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed -- You tried to access a kitten with an invalid method.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable -- You requested a format that isn&#39;t json.</td>
</tr>
<tr>
<td>410</td>
<td>Gone -- The kitten requested has been removed from our servers.</td>
</tr>
<tr>
<td>418</td>
<td>I&#39;m a teapot.</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests -- You&#39;re requesting too many kittens! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error -- We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable -- We&#39;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
